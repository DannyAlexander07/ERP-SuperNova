<div class="table-module-container">
    
    <div class="module-header-tabs">
        <div class="header-titles">
            <h2>üí∞ Finanzas y Tesorer√≠a</h2>
            <p>Control de gastos, pago a proveedores.</p>
        </div>
        <div class="tabs-wrapper">
            <button class="tab-btn active" onclick="cambiarTab('tab-gastos')">
                <i class='bx bx-receipt'></i> Registro de Compras
            </button>
            <button class="tab-btn" onclick="cambiarTab('tab-cuentas')">
                <i class='bx bx-money-withdraw'></i> Cuentas por Pagar
            </button>
            <button class="tab-btn" onclick="cambiarTab('tab-tesoreria')">
                <i class='bx bx-calendar-check'></i> Tesorer√≠a (Hoy)
            </button>
        </div>
    </div>

    <div id="tab-gastos" class="tab-content active">
        <div class="table-toolbar" style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 15px;">
            <div class="actions" style="display: flex; gap: 10px;">
                <button class="btn-primary" onclick="abrirModalFactura()">
                    <i class='bx bx-plus-circle'></i> Nueva Compra
                </button>
                <button class="btn-icon" onclick="exportarExcel()" title="Exportar Excel">
                    <i class='bx bxs-file-export' style="color: #1D6F42; font-size: 1.8rem;"></i>
                </button>
            </div>
        </div>

    <div class="table-responsive">
        <table class="premium-table">
            <thead>
                <tr>
                    <th onclick="ordenarGastos('fecha_emision')" style="cursor:pointer;">
                        Emisi√≥n <i class='bx bx-sort-alt-2'></i>
                    </th>
                    <th onclick="ordenarGastos('fecha_programacion')" style="cursor:pointer;">
                        Programaci√≥n <i class='bx bx-sort-alt-2'></i>
                    </th>
                    <th onclick="ordenarGastos('fecha_vencimiento')" style="cursor:pointer;">
                        Vencimiento <i class='bx bx-sort-alt-2'></i>
                    </th>
                    <th>Proveedor</th>
                    <th>Documento</th>
                    <th onclick="ordenarGastos('monto_total')" style="cursor:pointer;">
                        Total <i class='bx bx-sort-alt-2'></i>
                    </th>
                    <th>Estado</th>
                    <th onclick="ordenarGastos('dias_mora')" style="cursor:pointer;">
                        D√≠as Venc. <i class='bx bx-sort-alt-2'></i>
                    </th>
                    <th>Clasificaci√≥n</th>
                    <th style="text-align:center;">Evidencia</th>
                    <th style="text-align:center;">Acciones</th>
                </tr>
                <tr id="row-filtros-gastos" class="filter-row-header">
                    <td></td> <td></td> <td></td>
                    <td>
                        <input type="text" class="column-filter" placeholder="üîç Proveedor..." 
                            onkeyup="filtrarColumna(this, 3, 'tabla-facturas-body')">
                    </td>
                    <td>
                        <input type="text" class="column-filter" placeholder="üîç N¬∞..." 
                            onkeyup="filtrarColumna(this, 4, 'tabla-facturas-body')">
                    </td>
                    <td></td> <td></td> <td></td> <td></td> <td></td> <td></td>
                </tr>
            </thead>
            <tbody id="tabla-facturas-body"></tbody>
        </table>
    </div>
        <div id="facturas-paginacion" class="pagination-container"></div>
    </div>

    <div id="tab-cuentas" class="tab-content">
        <div class="kpi-resumen-bar">
            <div class="kpi-card success" style="border-left: 4px solid #10b981;">
                <span>Pagado Hoy</span>
                <div style="display: flex; flex-direction: column; gap: 4px; margin-top: 5px;">
                    <h3 id="kpi-pagado-hoy-pen" style="margin: 0; font-size: 1.3rem;">S/ 0.00</h3>
                    <h3 id="kpi-pagado-hoy-usd" style="margin: 0; font-size: 1.1rem; color: #059669;">$ 0.00</h3>
                </div>
                <small style="color:#10b981; font-weight:600; margin-top: 8px; display: block;"> <i class='bx bx-check'></i> Al d√≠a</small>
            </div>

            <div class="kpi-card info" style="border-left: 4px solid #3b82f6;">
                <span id="lbl-mes">Acumulado Mes Actual</span>
                <div style="display: flex; flex-direction: column; gap: 4px; margin-top: 5px;">
                    <h3 id="kpi-pagado-mes-pen" style="color:#3b82f6; margin: 0; font-size: 1.3rem;">S/ 0.00</h3>
                    <h3 id="kpi-pagado-mes-usd" style="color:#2563eb; margin: 0; font-size: 1.1rem;">$ 0.00</h3>
                </div>
                <small style="color:#64748b; margin-top: 8px; display: block;">Reinicia a fin de mes</small>
            </div>

            <div class="kpi-card warning" style="border-left: 4px solid #f59e0b;">
                <span id="lbl-anio">Total A√±o Actual</span>
                <div style="display: flex; flex-direction: column; gap: 4px; margin-top: 5px;">
                    <h3 id="kpi-pagado-anio-pen" style="color:#f59e0b; margin: 0; font-size: 1.3rem;">S/ 0.00</h3>
                    <h3 id="kpi-pagado-anio-usd" style="color:#d97706; margin: 0; font-size: 1.1rem;">$ 0.00</h3>
                </div>
                <small style="color:#64748b; margin-top: 8px; display: block;">Egresos totales</small>
            </div>

            <div class="kpi-card" style="border-left: 4px solid #8b5cf6; background:#f5f3ff;">
                <span style="color:#7c3aed;">Total por Pagar</span>
                <div style="display: flex; flex-direction: column; gap: 4px; margin-top: 5px;">
                    <h3 id="kpi-total-pendiente-pen" style="color:#7c3aed; margin: 0; font-size: 1.3rem;">S/ 0.00</h3>
                    <h3 id="kpi-total-pendiente-usd" style="color:#6d28d9; margin: 0; font-size: 1.1rem;">$ 0.00</h3>
                </div>
                <small style="color:#8b5cf6; margin-top: 8px; display: block;">Deuda Global</small>
            </div>

            <div class="kpi-card danger" style="border-left: 4px solid #ef4444; background:#fef2f2;">
                <span style="color:#ef4444;">Deuda Vencida</span>
                <div style="display: flex; flex-direction: column; gap: 4px; margin-top: 5px;">
                    <h3 id="kpi-vencido-pen" style="color:#ef4444; margin: 0; font-size: 1.3rem;">S/ 0.00</h3>
                    <h3 id="kpi-vencido-usd" style="color:#dc2626; margin: 0; font-size: 1.1rem;">$ 0.00</h3>
                </div>
                <small style="margin-top: 8px; display: block;">¬°Atenci√≥n!</small>
            </div>
        </div>

        <div class="table-toolbar" style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
            <div class="filter-actions">
                <button class="btn-icon" onclick="exportarExcelCuentas()" title="Exportar Cuentas por Pagar">
                    <i class='bx bxs-file-export' style="color: #1D6F42; font-size: 1.8rem;"></i>
                </button>
            </div>
        </div>

        <div class="table-responsive">
            <table class="premium-table">
                <thead>
                    <tr>
                        <th onclick="ordenarCuentas('fecha_vencimiento')" style="cursor:pointer;">
                            Vencimiento <i class='bx bx-sort-alt-2'></i>
                        </th>
                        <th>Sem√°foro</th>
                        <th onclick="ordenarCuentas('fecha_programacion')" style="cursor:pointer;">
                            Programaci√≥n <i class='bx bx-sort-alt-2'></i>
                        </th>
                        <th>Proveedor</th>
                        <th>Factura</th>
                        <th onclick="ordenarCuentas('monto_total')" style="cursor:pointer;">
                            Deuda Total <i class='bx bx-sort-alt-2'></i>
                        </th>
                        <th>Amortizacion</th>
                        <th onclick="ordenarCuentas('saldo_pendiente')" style="cursor:pointer;">
                            Saldo Pendiente <i class='bx bx-sort-alt-2'></i>
                        </th>
                        <th style="text-align: center;">Acciones</th>
                    </tr>
                    <tr id="row-filtros-cuentas" class="filter-row-header">
                        <td></td> <td></td> <td></td> <td><input type="text" class="column-filter" placeholder="üîç Proveedor..." onkeyup="filtrarColumna(this, 3, 'tabla-cuentas-body')"></td>
                        <td><input type="text" class="column-filter" placeholder="üîç N¬∞..." onkeyup="filtrarColumna(this, 4, 'tabla-cuentas-body')"></td>
                        <td></td> <td></td> <td></td> <td></td> </tr>
                </thead>
                <tbody id="tabla-cuentas-body">
                    </tbody>
            </table>
        </div>
        <div id="cuentas-paginacion" class="pagination-container"></div>
    </div>

    <div id="tab-tesoreria" class="tab-content">
        
        <div class="kpi-resumen-bar" style="grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px;">
            
            <div class="kpi-card" style="border-left: 5px solid #3b82f6; background: #eff6ff;">
                <span style="color: #1e40af; font-weight: 700; font-size: 0.9rem;">‚ö° FLUJO OPERATIVO</span>
                <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 10px;">
                    <h3 id="block-op-pen" style="margin: 0; font-size: 1.5rem; color: #1e3a8a;">S/ 0.00</h3>
                    <h3 id="block-op-usd" style="margin: 0; font-size: 1.2rem; color: #3b82f6;">$ 0.00</h3>
                </div>
                <small style="color: #64748b;">Mantenimiento y servicios</small>
            </div>

            <div class="kpi-card" style="border-left: 5px solid #8b5cf6; background: #f5f3ff;">
                <span style="color: #5b21b6; font-weight: 700; font-size: 0.9rem;">üõ†Ô∏è IMPLEMENTACI√ìN</span>
                <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 10px;">
                    <h3 id="block-imp-pen" style="margin: 0; font-size: 1.5rem; color: #4c1d95;">S/ 0.00</h3>
                    <h3 id="block-imp-usd" style="margin: 0; font-size: 1.2rem; color: #8b5cf6;">$ 0.00</h3>
                </div>
                <small style="color: #64748b;">Nuevos activos y mejoras</small>
            </div>

            <div class="kpi-card" style="border-left: 5px solid #f59e0b; background: #fffbeb;">
                <span style="color: #92400e; font-weight: 700; font-size: 0.9rem;">üè¶ FINANCIERO</span>
                <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 10px;">
                    <h3 id="block-fin-pen" style="margin: 0; font-size: 1.5rem; color: #78350f;">S/ 0.00</h3>
                    <h3 id="block-fin-usd" style="margin: 0; font-size: 1.2rem; color: #f59e0b;">$ 0.00</h3>
                </div>
                <small style="color: #64748b;">Pr√©stamos e impuestos</small>
            </div>
        </div>

        <div class="table-toolbar">
            <div class="header-titles">
                <h3 style="margin:0; color:#1e293b;">üìÖ Pagos Programados para Hoy</h3>
                <p style="margin:0; font-size:0.85rem; color:#64748b;">Confirme los egresos para que impacten en el balance real.</p>
            </div>
            <div class="filter-actions">
                <button class="btn-icon" onclick="exportarExcelTesoreria()" title="Exportar Plan de Pagos">
                    <i class='bx bxs-file-export' style="color: #1D6F42; font-size: 1.8rem;"></i>
                </button>
            </div>
        </div>

        <div class="table-responsive">
            <table class="premium-table">
                <thead>
                    <tr>
                        <th>Clasificaci√≥n</th>
                        <th>Proveedor</th>
                        <th>Documento</th>
                        <th>Banco / Cuenta / CCI</th>
                        <th>Vencimiento</th>
                        <th>Moneda</th>
                        <th>Saldo a Pagar</th>
                        <th style="text-align: center;">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tabla-tesoreria-body">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="modal-factura" class="modal-overlay">
        <div class="modal-content slide-in-right">
            <div class="modal-header">
                <h3>Registrar Gasto / Compra</h3>
                <button class="btn-close" onclick="cerrarModalFactura()"><i class='bx bx-x'></i></button>
            </div>
            
            <div class="modal-body">
                <form id="form-nueva-factura">
                    <input type="hidden" id="fac-id">

                    <h4 class="form-subtitle">Proveedor</h4>
                    <div class="input-group" style="width: 100%;">
                        <select id="fac-proveedor" required style="width: 100%;">
                            <option value="" disabled selected>-- Cargando proveedores... --</option>
                        </select>
                        <label class="static">Raz√≥n Social</label>
                    </div>

                    <h4 class="form-subtitle">Datos del Documento</h4>
                    <div class="row-grid">
                        <div class="input-group">
                            <select id="fac-tipo" onchange="toggleInputsDocumento()">
                                <option value="Factura">Factura</option>
                                <option value="Boleta">Boleta</option>
                                <option value="Invoice2">Invoice</option>
                                <option value="RHE">Recibo Honorarios</option>
                                <option value="Sin Documento">Sin Documento</option>
                            </select>
                            <label class="static">Tipo Doc.</label>
                        </div>

                        <div id="bloque-doble-input" style="display: contents;">
                            <div class="input-group">
                                <input type="text" id="fac-serie" placeholder="F001" style="text-transform: uppercase;">
                                <label>Serie</label>
                            </div>
                            <div class="input-group">
                                <input type="text" id="fac-numero" placeholder="0004321">
                                <label>Correlativo</label>
                            </div>
                        </div>

                        <div id="bloque-unico-input" class="input-group" style="display: none; grid-column: span 2;">
                            <input type="text" id="fac-doc-unico" placeholder="Ingrese N¬∞ o C√≥digo">
                            <label>N¬∞ Documento / Serie</label>
                        </div>
                    </div>

                    <div class="row-grid">
                        <div class="input-group">
                            <input type="date" id="fac-emision" required>
                            <label class="static">Fecha Emisi√≥n</label>
                        </div>
                        
                        <div class="input-group">
                            <input type="date" id="fac-vencimiento" required>
                            <label class="static">Fecha Vencimiento</label>
                        </div>
                    </div>

                    <div class="input-group">
                        <input type="date" id="fac-programacion">
                        <label class="static">Fecha Programaci√≥n</label>
                    </div>

                    <h4 class="form-subtitle">Detalles Financieros (C√°lculo Autom√°tico)</h4>
                    <div class="row-grid" style="grid-template-columns: 1fr 1fr 1fr; margin-bottom: 10px;"> 
                        <div class="input-group">
                            <select id="fac-moneda">
                                <option value="PEN">S/ (Soles)</option>
                                <option value="USD">$ (D√≥lares)</option>
                            </select>
                            <label class="static">Moneda</label>
                        </div>
                        
                        <div class="input-group">
                            <input type="number" id="fac-base" required placeholder="0.00" step="0.01" oninput="calcularTotalImpuesto()">
                            <label>Monto Base (Gravado)</label>
                        </div>

                        <div class="input-group">
                            <select id="fac-impuesto-porc" onchange="toggleImpuestoOtros(); calcularTotalImpuesto();">
                                <option value="18">18% (IGV - Suma)</option>
                                <option value="10.5">10.5% (Suma)</option>
                                <option value="0">0% (Exonerado)</option>
                                <option value="8">8% (Resta / Retenci√≥n)</option>
                                <option value="otros">Otros (Personalizado)</option>
                            </select>
                            <label class="static">% Impuesto</label>
                        </div>
                    </div>

                    <div id="fac-otros-container" class="row-grid" style="display: none; grid-template-columns: 1fr 1fr; background: #f8fafc; padding: 12px; border-radius: 8px; border: 1px dashed #cbd5e1; margin-bottom: 15px; gap: 15px;">
                        <div class="input-group">
                            <select id="fac-otros-operacion" onchange="calcularTotalImpuesto()">
                                <option value="suma">Suma (+)</option>
                                <option value="resta">Resta (-)</option>
                            </select>
                            <label class="static">Tipo de Operaci√≥n</label>
                        </div>
                        <div class="input-group">
                            <input type="number" id="fac-otros-porcentaje" placeholder="Ej: 5" step="0.1" oninput="calcularTotalImpuesto()">
                            <label>Porcentaje Manual (%)</label>
                        </div>
                    </div>

                    <div style="background: #f1f5f9; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e2e8f0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <p style="font-size: 0.75rem; font-weight: bold; color: #64748b; text-transform: uppercase; margin: 0;">
                                Adicionales No Gravados (No suman impuesto)
                            </p>
                            <button type="button" onclick="agregarFilaAdicional()" style="padding: 2px 8px; background: #64748b; color: white; border-radius: 4px; border: none; cursor: pointer; font-size: 12px;">
                                <i class='bx bx-plus'></i> A√±adir
                            </button>
                        </div>

                        <div id="contenedor-adicionales">
                            <div class="row-grid fila-adicional" style="grid-template-columns: 2fr 1fr auto; gap: 10px; margin-bottom: 8px;">
                                <div class="input-group" style="margin-bottom: 0;">
                                    <input type="text" class="adicional-glosa" placeholder="Ej: Propina">
                                    <label>Descripci√≥n</label>
                                </div>
                                <div class="input-group" style="margin-bottom: 0;">
                                    <input type="number" class="adicional-monto" placeholder="0.00" step="0.01" oninput="calcularTotalImpuesto()">
                                    <label>Monto</label>
                                </div>
                                <div style="width: 30px;"></div> 
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <input type="number" id="fac-total-final" readonly style="background-color: #f1f5f9; font-weight: 900; color: #0f172a; font-size: 1.2rem; border: 2px solid #cbd5e1;">
                        <label class="static">Monto Total a Pagar</label>
                    </div>

                    <div class="input-group">
                        <input type="text" id="fac-glosa" required placeholder="Ej: Compra de gaseosas para el mes">
                        <label>Descripci√≥n del Gasto</label>
                    </div>

                    <h4 class="form-subtitle">Datos Bancarios y Clasificaci√≥n</h4>
                    <div class="row-grid">
                        <div class="input-group">
                            <select id="fac-banco"> 
                                <option value="">-- Seleccionar Banco --</option>
                                <option value="BCP">BCP</option>
                                <option value="BBVA">BBVA</option>
                                <option value="Scotiabank">Scotiabank</option>
                                <option value="Interbank">Interbank</option>
                            </select>
                            <label class="static">Banco</label>
                        </div>
                        <div class="input-group">
                            <select id="fac-clasificacion" required> 
                                <option value="Operativo">Operativo</option>
                                <option value="Implementacion">Implementaci√≥n</option>
                                <option value="Financiero">Financiero</option>
                            </select>
                            <label class="static">Clasificaci√≥n</label>
                        </div>
                    </div>

                    <div class="row-grid">
                        <div class="input-group">
                            <input type="text" id="fac-cuenta" placeholder="N¬∞ Cuenta"> <label>N√∫mero de Cuenta</label>
                        </div>
                        <div class="input-group">
                            <input type="text" id="fac-cci" placeholder="CCI"> <label>Cuenta Interbancaria (CCI)</label>
                        </div>
                    </div>

                    <div class="row-grid">
                        <div class="input-group">
                            <select id="fac-sede" required>
                                <option value="" disabled selected>Cargando...</option>
                            </select>
                            <label class="static">Sede</label>
                        </div>
                        <div class="input-group">
                            <select id="fac-linea" required>
                                <option value="operativo">Gasto Operativo</option>
                                <option value="insumos">Insumos / Mercader√≠a</option>
                                <option value="rrhh">Personal / Planilla</option>
                                <option value="mantenimiento">Mantenimiento</option>
                                <option value="servicios">Servicios</option>
                                <option value="impuestos">Impuestos / SUNAT</option>
                            </select>
                            <label class="static">Categor√≠a</label>
                        </div>
                    </div>

                    <div class="file-upload-zone" id="drop-zone">
                        <i class='bx bxs-cloud-upload'></i>
                        <p>Adjuntar Foto o PDF</p>
                        <p class="file-info" id="file-name-display"></p>
                        <input type="file" id="fac-archivo" hidden accept=".pdf, .jpg, .png, .jpeg">
                    </div>

                    <div style="margin-top:15px; display:flex; gap:10px; align-items:center; background:#f0fdf4; padding:10px; border-radius:8px; border:1px solid #bbf7d0;">
                        <input type="checkbox" id="check-pagar-ahora" style="width:20px; height:20px;">
                        <label for="check-pagar-ahora" style="color:#166534; font-weight:600; cursor:pointer;">¬øPago Realizado? (Ya pagado)</label>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button class="btn-cancel" onclick="cerrarModalFactura()">Cancelar</button>
                <button class="btn-primary" onclick="guardarFactura()">Guardar Compra</button>
            </div>
        </div>
    </div>

    <div id="modal-pago" class="modal-overlay" style="z-index: 2100;">
        <div class="modal-content center-modal" style="max-width: 450px; padding: 0;">
            <div class="modal-header" style="background-color: #f0fdf4; border-bottom: 1px solid #bbf7d0; padding: 20px;">
                <h3 style="color: #166534;"><i class='bx bx-money-withdraw'></i> Registrar Salida de Dinero</h3>
                <button class="btn-close" onclick="cerrarModalPago()"><i class='bx bx-x'></i></button>
            </div>
            
            <div class="modal-body" style="padding: 20px;">
                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <p style="margin: 0 0 5px 0; font-size: 0.85rem; color: #64748b; text-transform: uppercase;">Pagando a:</p>
                    <h4 id="pago-proveedor-txt" style="margin: 0 0 10px 0; color: #0f172a;">-</h4>
                    
                    <div style="display: flex; justify-content: space-between; border-top: 1px dashed #cbd5e1; padding-top: 10px;">
                        <div>
                            <span style="font-size: 0.8rem; color: #64748b;">Documento:</span>
                            <strong id="pago-doc-txt" style="display: block; color: #334155;">-</strong>
                        </div>
                        <div style="text-align: right;">
                            <span style="font-size: 0.8rem; color: #64748b;">Saldo Pendiente:</span>
                            <strong id="pago-saldo-txt" style="display: block; color: #ef4444; font-size: 1.1rem;">-</strong>
                        </div>
                    </div>
                </div>

                <input type="hidden" id="pago-ref-id"> 
                <input type="hidden" id="pago-tipo-origen">
                
                <div class="input-group">
                    <input type="number" id="pago-monto" required step="0.01" placeholder="0.00" style="font-size:1.8rem; color:#10b981; font-weight:bold; text-align: center;">
                    <label>Monto a Pagar</label>
                </div>

                <div class="input-group">
                    <select id="pago-metodo">
                        <option value="Caja Chica">Caja Chica (Efectivo)</option>
                        <option value="Transferencia BCP">Transferencia BCP</option>
                        <option value="Transferencia BBVA">Transferencia BBVA</option>
                        <option value="Transferencia Interbank">Transferencia Interbank</option>
                        <option value="Yape/Plin">Yape / Plin</option>
                        <option value="Tarjeta">Tarjeta Corporativa</option>
                    </select>
                    <label class="static">Origen del Dinero (M√©todo)</label>
                </div>

                <div class="row-grid">
                    <div class="input-group">
                        <input type="date" id="pago-fecha" required>
                        <label class="static">Fecha de Pago</label>
                    </div>
                    <div class="input-group">
                        <input type="text" id="pago-operacion" placeholder="Ej: OP-123456">
                        <label>N¬∞ Operaci√≥n</label>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer" style="padding: 15px 20px; background: #f8fafc; border-top: 1px solid #e2e8f0;">
                <button class="btn-cancel" onclick="cerrarModalPago()">Cancelar</button>
                <button class="btn-primary" style="background-color: #10b981; border-color: #10b981;" onclick="confirmarPago()"><i class='bx bx-check-circle'></i> Confirmar Pago</button>
            </div>
        </div>
    </div>

    <div id="modal-detalles-ver" class="modal-overlay" style="z-index: 2000;">
        <div class="modal-content slide-in-right" style="max-width: 850px; padding: 0;">
            
            <div class="modal-header" style="padding: 20px;">
                <h3>Detalles de Compra <span id="ver-modal-doc" class="badge bg-blue" style="font-size: 0.9rem;"></span></h3>
                <button class="btn-close" onclick="cerrarModalDetallesVer()"><i class='bx bx-x'></i></button>
            </div>
            
            <div class="modal-body" style="padding: 0;">
                <div class="tabs-wrapper" style="border-bottom: 1px solid #e2e8f0; padding: 0 20px; gap: 15px;">
                    <button class="tab-btn active" id="btn-tab-ver-info" onclick="cambiarTabModalVer('info')">
                        <i class='bx bx-info-circle'></i> Informaci√≥n
                    </button>
                    <button class="tab-btn" id="btn-tab-ver-docs" onclick="cambiarTabModalVer('docs')">
                        <i class='bx bx-folder-open'></i> Documentos
                    </button>
                    <button class="tab-btn" id="btn-tab-ver-pagos" onclick="cambiarTabModalVer('pagos')">
                        <i class='bx bx-money'></i> Historial de Pagos
                    </button>
                </div>

                <div style="padding: 20px;">
                    
                    <div id="tab-ver-info" style="display: block;">
                        <div class="row-grid" style="margin-bottom: 20px; grid-template-columns: 1.5fr 1fr;">
                            <div>
                                <h4 class="form-subtitle">Proveedor y Clasificaci√≥n</h4>
                                <p style="font-weight: 600; font-size: 1.1rem; color: #1e293b; margin-bottom: 4px;" id="ver-info-proveedor">-</p>
                                <span id="ver-info-clasificacion" class="badge" style="background:#eff6ff; color:#3b82f6; font-size: 0.75rem;">-</span>
                            </div>
                            <div>
                                <h4 class="form-subtitle">Sede y Categor√≠a</h4>
                                <p><strong>Sede:</strong> <span id="ver-info-sede">-</span></p>
                                <p><strong>Categor√≠a:</strong> <span id="ver-info-categoria" style="text-transform: capitalize;">-</span></p>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px; padding: 12px; background: #fdfdfd; border: 1px solid #f1f5f9; border-radius: 8px;">
                            <h4 class="form-subtitle">Glosa / Descripci√≥n</h4>
                            <p id="ver-info-glosa" style="color: #475569; line-height: 1.5; font-style: italic;">-</p>
                        </div>

                        <div class="row-grid" style="margin-bottom: 20px; grid-template-columns: 1fr 1fr;">
                            <div>
                                <h4 class="form-subtitle">Documento</h4>
                                <p><strong>Tipo:</strong> <span id="ver-info-tipo-doc">-</span></p>
                                <p><strong>N¬∞ Documento:</strong> <span id="ver-info-num-doc" style="font-family: monospace; font-weight: bold;">-</span></p>
                                <p><strong>Estado:</strong> <span id="ver-info-estado-pago">-</span></p>
                            </div>
                            <div>
                                <h4 class="form-subtitle">Fechas</h4>
                                <p><strong>Emisi√≥n:</strong> <span id="ver-info-emision">-</span></p>
                                <p><strong>Vencimiento:</strong> <span id="ver-info-vencimiento">-</span></p>
                                <p><strong>Programaci√≥n:</strong> <span id="ver-info-programacion">-</span></p>
                            </div>
                        </div>

                        <h4 class="form-subtitle">Resumen Financiero</h4>
                        <div class="row-grid" style="background: #f8fafc; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 20px; grid-template-columns: repeat(3, 1fr);">
                            <div>
                                <p style="color: #64748b; font-size: 0.85rem; margin-bottom: 5px;">Monto Total</p>
                                <p style="font-weight: 800; font-size: 1.25rem; color: #0f172a;" id="ver-info-total">-</p>
                            </div>
                            <div>
                                <p style="color: #64748b; font-size: 0.85rem; margin-bottom: 5px;">A Cuenta (Pagado)</p>
                                <p style="font-weight: 800; font-size: 1.25rem; color: #10b981;" id="ver-info-pagado">-</p>
                            </div>
                            <div>
                                <p style="color: #64748b; font-size: 0.85rem; margin-bottom: 5px;">Saldo Pendiente</p>
                                <p style="font-weight: 800; font-size: 1.25rem; color: #ef4444;" id="ver-info-deuda">-</p>
                            </div>
                        </div>

                        <h4 class="form-subtitle">Datos Bancarios para Pago</h4>
                        <div class="row-grid" style="background: #f0fdf4; padding: 15px; border-radius: 8px; border: 1px solid #bbf7d0; grid-template-columns: 1fr 1fr 1fr;">
                            <p><strong>Banco:</strong> <br><span id="ver-info-banco">-</span></p>
                            <p><strong>Cuenta:</strong> <br><span id="ver-info-cuenta">-</span></p>
                            <p><strong>CCI:</strong> <br><span id="ver-info-cci">-</span></p>
                        </div>
                    </div>

                    <div id="tab-ver-docs" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 class="form-subtitle" style="margin: 0;">Archivos Relacionados</h4>
                            <input type="hidden" id="ver-modal-factura-id">
                            <input type="file" id="input-subir-doc-extra" style="display: none;" onchange="ejecutarSubidaDocumentoExtra(event)">
                            <button class="btn-primary btn-sm" onclick="document.getElementById('input-subir-doc-extra').click()">
                                <i class='bx bx-cloud-upload'></i> Agregar Documento
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="premium-table">
                                <thead>
                                    <tr>
                                        <th>Archivo</th>
                                        <th>Fecha Subida</th>
                                        <th style="text-align: center;">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="ver-tabla-docs-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <div id="tab-ver-pagos" style="display: none;">
                        <h4 class="form-subtitle">Historial de Pagos Realizados</h4>
                        <div class="table-responsive">
                            <table class="premium-table">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Monto</th>
                                        <th>M√©todo</th>
                                        <th>Detalle / Operaci√≥n</th>
                                    </tr>
                                </thead>
                                <tbody id="ver-tabla-pagos-body"></tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
            
            <div class="modal-footer" style="padding: 15px 20px;">
                <button class="btn-cancel full-width" onclick="cerrarModalDetallesVer()">Cerrar Vista</button>
            </div>
        </div>
    </div>

    <div id="modal-confirmar-eliminar-doc" class="modal-overlay" style="z-index: 2200;">
        <div class="modal-content center-modal" style="max-width: 350px; text-align: center; padding: 30px 20px;">
            <div style="color: #ef4444; font-size: 3.5rem; margin-bottom: 10px;">
                <i class='bx bx-error-circle'></i>
            </div>
            <h3 style="margin-bottom: 10px; color: #0f172a;">¬øEliminar Archivo?</h3>
            <p style="color: #64748b; margin-bottom: 25px; font-size: 0.95rem;">
                Esta acci√≥n no se puede deshacer. El documento ser√° borrado permanentemente.
            </p>
            
            <input type="hidden" id="delete-doc-id">
            <input type="hidden" id="delete-doc-factura-id">

            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn-cancel" onclick="cerrarModalEliminarDoc()" style="flex: 1;">Cancelar</button>
                <button class="btn-primary" onclick="ejecutarEliminacionDoc()" style="flex: 1; background-color: #ef4444; border-color: #ef4444; color: white;">S√≠, Eliminar</button>
            </div>
        </div>
    </div>
    <div id="modal-confirmar-flujo" class="modal-overlay" style="z-index: 2200;">
        <div class="modal-content center-modal" style="max-width: 400px; text-align: center; padding: 30px 20px;">
            
            <div id="flujo-modal-icon" style="font-size: 3.5rem; margin-bottom: 10px;">
                <i class='bx bx-question-mark'></i>
            </div>
            
            <h3 id="flujo-modal-title" style="margin-bottom: 10px; color: #0f172a;">Confirmar Acci√≥n</h3>
            <p id="flujo-modal-text" style="color: #64748b; margin-bottom: 25px; font-size: 0.95rem;">
                ¬øEst√°s seguro de continuar?
            </p>
            
            <input type="hidden" id="flujo-factura-id">
            <input type="hidden" id="flujo-nuevo-estado">

            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn-cancel" onclick="cerrarModalFlujo()" style="flex: 1;">Cancelar</button>
                <button id="flujo-modal-btn" class="btn-primary" onclick="ejecutarCambioFlujo()" style="flex: 1;">S√≠, Confirmar</button>
            </div>
        </div>
    </div>
</div>